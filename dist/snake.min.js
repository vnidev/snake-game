!function(){var s=0,i=1,c=2,r=3;function E(e,n){if(E.instance_)return E.instance_;E.instance_=this,n&&(n.SPEED?10<n.SPEED?n.SPEED=10:n.SPEED<1&&(n.SPEED=1):n.SPEED=E.config.SPEED,n.BOARD_WIDTH?40<n.BOARD_WIDTH?n.BOARD_WIDTH=40:n.BOARD_WIDTH<10&&(n.BOARD_WIDTH=10):n.BOARD_WIDTH=E.config.BOARD_WIDTH,n.BOARD_HEIGHT?20<n.BOARD_HEIGHT?n.BOARD_HEIGHT=20:n.BOARD_HEIGHT<5&&(n.BOARD_HEIGHT=5):n.BOARD_HEIGHT=E.config.BOARD_HEIGHT),E.instance_.config=n||E.config,E.instance_.params=E.params,E.instance_.params.SPEED=E.instance_.config.SPEED,E.instance_.config.BOARD_HEIGHT+=2,E.instance_.config.BOARD_WIDTH+=2,this.rootDiv=document.querySelector(e);var a=window.innerWidth,t=window.innerHeight;(a<E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH+20||t<E.instance_.config.BOARD_HEIGHT*E.instance_.params.PIECE_WIDTH+20)&&(E.params.PIECE_WIDTH=16),this.scoreDivEl=document.createElement("div"),this.scoreDivEl.className=E.classes.SCORE,this.scoreDivEl.style.width=E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH+"px",this.highscoreDiv=document.createElement("div"),this.highscoreDiv.style.float="left",this.highScoreTextEl=document.createElement("label"),this.highScoreTextEl.innerHTML="Highscore: ",this.highscoreDiv.appendChild(this.highScoreTextEl),this.highScoreEl=document.createElement("label"),this.highScoreEl.id="lblHighscore",this.highScoreEl.innerHTML="0",this.highscoreDiv.appendChild(this.highScoreEl),this.scoreDivEl.appendChild(this.highscoreDiv),this.scoreDiv=document.createElement("div"),this.scoreDiv.style.float="right",this.scoreTextEl=document.createElement("label"),this.scoreTextEl.innerHTML="Score: ",this.scoreDiv.appendChild(this.scoreTextEl),this.scoreEl=document.createElement("label"),this.scoreEl.id="lblScore",this.scoreEl.innerHTML="0",this.scoreDiv.appendChild(this.scoreEl),this.scoreDivEl.appendChild(this.scoreDiv),this.rootDiv.appendChild(this.scoreDivEl),this.gameEl=document.createElement("div"),this.gameEl.className=E.classes.CONTAINER,this.rootDiv.appendChild(this.gameEl),this.rootDiv.style.width=E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH+"px",E.instance_.containerElement=this.gameEl,E.instance_.containerElement.style.width=E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH+"px",E.instance_.containerElement.style.height=E.instance_.config.BOARD_HEIGHT*E.instance_.params.PIECE_WIDTH+"px",this.scoreGameProgressEl=document.createElement("div"),this.scoreGameProgressEl.className=E.classes.PROGRESS,this.scoreGameProgressEl.style.width=E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH+"px",this.progressEl=document.createElement("label"),this.progressEl.id="lblStatus",this.progressEl.innerHTML="Press space to start game",this.scoreGameProgressEl.appendChild(this.progressEl),this.rootDiv.appendChild(this.scoreGameProgressEl),E.instance_.init()}function t(){var e=Math.ceil((E.instance_.config.BOARD_HEIGHT-2)/2);this.position=[{x:4,y:e},{x:3,y:e},{x:2,y:e}],this.init()}function e(){this.init()}function o(){this.init()}(window.Game=E).params={SPEED:1,FPS:35,CURRENT_FRAME:0,STARTED:!1,DIRECTION:r,PIECE_WIDTH:32,CAN_MOVE:!0,NEXT_MOVE:null,LEVELS:[30,35,25,20,15,12,10,8,6,4],LEVEL_UP:[5,10,17,25,35,50,75,110,150]},E.config={SPEED:1,BOARD_WIDTH:20,BOARD_HEIGHT:10},E.classes={CONTAINER:"container",SCORE:"score",PROGRESS:"progress",PLAYER:"sprite_background",BORDER:"border_background",FOOD:"food_background"},E.prototype={init:function(){document.addEventListener("keydown",function(e){E.instance_.keyPressAction(e)}.bind(E.instance_)),E.instance_.board=new e},gameProgress:function(){if(E.instance_.params.CURRENT_FRAME==E.instance_.params.LEVELS[E.instance_.params.SPEED-1]){E.instance_.params.CAN_MOVE=!0;var e,n=E.instance_.player.position[0];switch(E.instance_.params.DIRECTION){case s:e={x:n.x,y:n.y-1};break;case i:e={x:n.x,y:n.y+1};break;case c:e={x:n.x-1,y:n.y};break;default:e={x:n.x+1,y:n.y}}if(E.instance_.player.position.unshift(e),e.x==E.instance_.food.position.x&&e.y==E.instance_.food.position.y)E.instance_.player.expandPlayer(e);else{var a=E.instance_.player.position.pop();E.instance_.player.movePlayerPiece(e,a)}E.instance_.params.CURRENT_FRAME=0,E.instance_.params.NEXT_MOVE&&(E.instance_.params.DIRECTION=E.instance_.params.NEXT_MOVE,E.instance_.params.NEXT_MOVE=null)}E.instance_.params.STARTED&&(E.instance_.params.CURRENT_FRAME++,window.requestAnimationFrame(E.instance_.gameProgress.bind(this)))},keyPressAction:function(e){switch(e.which){case 32:if(e.preventDefault(),!E.instance_.params.STARTED){E.instance_.params.STARTED=!0;var n=document.getElementsByClassName(E.classes.PLAYER);if(0<n.length)for(;n[0];)E.instance_.containerElement.removeChild(n[0]);var a=document.getElementById("food_item");a&&E.instance_.containerElement.removeChild(a),document.getElementById("lblScore").innerHTML=0,E.instance_.params.SPEED=E.instance_.config.SPEED,E.instance_.params.CAN_MOVE=!0,E.instance_.params.DIRECTION=r,E.instance_.player=new t,E.instance_.food=new o,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+E.instance_.params.SPEED,E.instance_.gameProgress()}break;case 37:case 39:e.preventDefault(),E.instance_.params.STARTED&&E.instance_.params.DIRECTION!=c&&E.instance_.params.DIRECTION!=r&&(E.instance_.params.CAN_MOVE?(E.instance_.params.NEXT_MOVE=null,E.instance_.params.CAN_MOVE=!1,E.instance_.params.DIRECTION=37==e.which?c:r):E.instance_.params.NEXT_MOVE=37==e.which?c:r);break;case 38:case 40:e.preventDefault(),E.instance_.params.STARTED&&E.instance_.params.DIRECTION!=i&&E.instance_.params.DIRECTION!=s&&(E.instance_.params.CAN_MOVE?(E.instance_.params.NEXT_MOVE=null,E.instance_.params.CAN_MOVE=!1,E.instance_.params.DIRECTION=38==e.which?s:i):E.instance_.params.NEXT_MOVE=38==e.which?s:i);break;case 88:E.instance_.params.SPEED<10&&E.instance_.params.STARTED&&(E.instance_.params.SPEED++,E.instance_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+E.instance_.params.SPEED);break;case 90:1<E.instance_.params.SPEED&&E.instance_.params.STARTED&&(E.instance_.params.SPEED--,E.instance_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+E.instance_.params.SPEED)}}},t.prototype={init:function(){for(var e=0;e<this.position.length;e++)this.drawPlayer(this.position[e])},movePlayerPiece:function(e,n){if(collisionDetected=this.checkForCollision(e),!collisionDetected){var a=document.getElementById("player_"+n.x+"_"+n.y);a.id="player_"+e.x+"_"+e.y,a.style.top=e.y*E.instance_.params.PIECE_WIDTH,a.style.left=e.x*E.instance_.params.PIECE_WIDTH}},expandPlayer:function(e){var n=document.getElementById("lblScore");score=parseInt(n.innerHTML)+1,n.innerHTML=parseInt(n.innerHTML)+1,score==E.instance_.params.LEVEL_UP[E.instance_.params.SPEED-1]&&E.instance_.params.SPEED<10&&(E.instance_.params.SPEED++,E.instance_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+E.instance_.params.SPEED),this.drawPlayer(e),E.instance_.containerElement.removeChild(document.getElementById("food_item")),E.instance_.food=new o},checkForCollision:function(e){var n=document.getElementById("player_"+e.x+"_"+e.y);if(E.instance_.params.DIRECTION==s&&0==e.y||E.instance_.params.DIRECTION==i&&e.y==E.instance_.config.BOARD_HEIGHT-1||E.instance_.params.DIRECTION==r&&e.x==E.instance_.config.BOARD_WIDTH-1||E.instance_.params.DIRECTION==c&&0==e.x||n){E.instance_.params.STARTED=!1,document.getElementById("player_"+E.instance_.player.position[1].x+"_"+E.instance_.player.position[1].y).style.backgroundColor="#aa0000";var a=document.getElementById("lblScore"),t=document.getElementById("lblHighscore");return parseInt(a.innerHTML)>parseInt(t.innerHTML)&&(t.innerHTML=a.innerHTML),document.getElementById("lblStatus").innerHTML="Game over",!0}return!1},drawPlayer:function(e){this.containerEl=document.createElement("div"),this.containerEl.id="player_"+e.x+"_"+e.y,this.containerEl.className=E.classes.PLAYER,this.containerEl.style.width=E.instance_.params.PIECE_WIDTH+"px",this.containerEl.style.height=E.instance_.params.PIECE_WIDTH+"px",this.containerEl.style.top=e.y*E.instance_.params.PIECE_WIDTH,this.containerEl.style.left=e.x*E.instance_.params.PIECE_WIDTH,E.instance_.containerElement.appendChild(this.containerEl)}},e.prototype={init:function(){this.drawBorder(0,0,E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH,E.instance_.params.PIECE_WIDTH),this.drawBorder((E.instance_.config.BOARD_HEIGHT-1)*E.instance_.params.PIECE_WIDTH,0,E.instance_.config.BOARD_WIDTH*E.instance_.params.PIECE_WIDTH,E.instance_.params.PIECE_WIDTH),this.drawBorder(0,0,E.instance_.params.PIECE_WIDTH,E.instance_.config.BOARD_HEIGHT*E.instance_.params.PIECE_WIDTH),this.drawBorder(0,(E.instance_.config.BOARD_WIDTH-1)*E.instance_.params.PIECE_WIDTH,E.instance_.params.PIECE_WIDTH,E.instance_.config.BOARD_HEIGHT*E.instance_.params.PIECE_WIDTH)},drawBorder:function(e,n,a,t){this.containerEl=document.createElement("div"),this.containerEl.className=E.classes.BORDER,this.containerEl.style.top=e+"px",this.containerEl.style.left=n+"px",this.containerEl.style.width=a+"px",this.containerEl.style.height=t+"px",E.instance_.containerElement.appendChild(this.containerEl)}},o.prototype={init:function(){for(var e=[],n=0;n<E.instance_.config.BOARD_HEIGHT-2;n++)for(var a=0;a<E.instance_.config.BOARD_WIDTH-2;a++)document.getElementById("player_"+(a+1)+"_"+(n+1))||e.push({x:a+1,y:n+1});var t=Math.floor(Math.random()*(e.length-1)),s={x:1,y:1};0<e.length&&(s=e[t]),this.position={x:s.x,y:s.y},this.containerEl=document.createElement("div"),this.containerEl.id="food_item",this.containerEl.className=E.classes.FOOD,this.containerEl.style.top=s.y*E.instance_.params.PIECE_WIDTH+"px",this.containerEl.style.left=s.x*E.instance_.params.PIECE_WIDTH+"px",this.containerEl.style.width=E.instance_.params.PIECE_WIDTH+"px",this.containerEl.style.height=E.instance_.params.PIECE_WIDTH+"px",E.instance_.containerElement.appendChild(this.containerEl)}}}();

!function(){var e=0,a=1,i=2,r=3;function n(e,a){if(n.i_)return n.i_;n.i_=this,a&&(a.SPEED?a.SPEED>10?a.SPEED=10:a.SPEED<1&&(a.SPEED=1):a.SPEED=n.config.SPEED,a.BOARD_WIDTH?a.BOARD_WIDTH>40?a.BOARD_WIDTH=40:a.BOARD_WIDTH<10&&(a.BOARD_WIDTH=10):a.BOARD_WIDTH=n.config.BOARD_WIDTH,a.BOARD_HEIGHT?a.BOARD_HEIGHT>20?a.BOARD_HEIGHT=20:a.BOARD_HEIGHT<5&&(a.BOARD_HEIGHT=5):a.BOARD_HEIGHT=n.config.BOARD_HEIGHT),n.i_.config=a||n.config,n.i_.params=n.params,n.i_.params.SPEED=n.i_.config.SPEED,n.i_.config.BOARD_HEIGHT+=2,n.i_.config.BOARD_WIDTH+=2;var i=document.querySelector(e),r=window.innerWidth,t=window.innerHeight;(r<n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH+20||t<n.i_.config.BOARD_HEIGHT*n.i_.params.PIECE_WIDTH+20)&&(n.params.PIECE_WIDTH=16);var _=document.createElement("div");_.className=n.classes.SCORE,_.style.width=n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH+"px";var E=document.createElement("div");E.style.float="left";var s=document.createElement("label");s.innerHTML="Highscore: ",E.appendChild(s);var o=document.createElement("label");o.id="lblHighscore",o.innerHTML="0",E.appendChild(o),_.appendChild(E);var l=document.createElement("div");l.style.float="right";var m=document.createElement("label");m.innerHTML="Score: ",l.appendChild(m);var p=document.createElement("label");p.id="lblScore",p.innerHTML="0",l.appendChild(p),_.appendChild(l),i.appendChild(_);var c=document.createElement("div");c.className=n.classes.CONTAINER,i.appendChild(c),i.style.width=n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH+"px",n.i_.containerElement=c,n.i_.containerElement.style.width=n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH+"px",n.i_.containerElement.style.height=n.i_.config.BOARD_HEIGHT*n.i_.params.PIECE_WIDTH+"px";var I=document.createElement("div");I.className=n.classes.PROGRESS,I.style.width=n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH+"px";var D=document.createElement("label");D.id="lblStatus",D.innerHTML="Press space to start game",I.appendChild(D),i.appendChild(I),n.i_.init()}function t(){var e=Math.ceil((n.i_.config.BOARD_HEIGHT-2)/2);this.pos=[{x:4,y:e},{x:3,y:e},{x:2,y:e}],this.init()}function _(){this.init()}function E(){this.init()}window.Game=n,n.params={SPEED:1,FPS:35,CURRENT_FRAME:0,STARTED:!1,DIRECTION:r,PIECE_WIDTH:32,CAN_MOVE:!0,NEXT_MOVE:null,LEVELS:[30,35,25,20,15,12,10,8,6,4],LEVEL_UP:[5,10,17,25,35,50,75,110,150]},n.config={SPEED:1,BOARD_WIDTH:20,BOARD_HEIGHT:10},n.classes={CONTAINER:"container",SCORE:"score",PROGRESS:"progress",PLAYER:"sprite_background",BORDER:"border_background",FOOD:"food_background"},n.prototype={init:function(){document.addEventListener("keydown",function(e){n.i_.keyPressAction(e)}.bind(n.i_)),n.i_.board=new _},gameProgress:function(){if(n.i_.params.CURRENT_FRAME==n.i_.params.LEVELS[n.i_.params.SPEED-1]){n.i_.params.CAN_MOVE=!0;var r,t=n.i_.player.pos[0];switch(n.i_.params.DIRECTION){case e:r={x:t.x,y:t.y-1};break;case a:r={x:t.x,y:t.y+1};break;case i:r={x:t.x-1,y:t.y};break;default:r={x:t.x+1,y:t.y}}if(n.i_.player.pos.unshift(r),r.x==n.i_.food.pos.x&&r.y==n.i_.food.pos.y)n.i_.player.expandPlayer(r);else{var _=n.i_.player.pos.pop();n.i_.player.movePlayerPiece(r,_)}n.i_.params.CURRENT_FRAME=0,n.i_.params.NEXT_MOVE&&(n.i_.params.DIRECTION=n.i_.params.NEXT_MOVE,n.i_.params.NEXT_MOVE=null)}n.i_.params.STARTED&&(n.i_.params.CURRENT_FRAME++,window.requestAnimationFrame(n.i_.gameProgress.bind(this)))},keyPressAction:function(_){switch(_.which){case 32:if(_.preventDefault(),!n.i_.params.STARTED){n.i_.params.STARTED=!0;var s=document.getElementsByClassName(n.classes.PLAYER);if(s.length>0)for(;s[0];)n.i_.containerElement.removeChild(s[0]);var o=document.getElementById("food_item");o&&n.i_.containerElement.removeChild(o),document.getElementById("lblScore").innerHTML=0,n.i_.params.SPEED=n.i_.config.SPEED,n.i_.params.CAN_MOVE=!0,n.i_.params.DIRECTION=r,n.i_.player=new t,n.i_.food=new E,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+n.i_.params.SPEED,n.i_.gameProgress()}break;case 37:case 39:_.preventDefault(),n.i_.params.STARTED&&n.i_.params.DIRECTION!=i&&n.i_.params.DIRECTION!=r&&(n.i_.params.CAN_MOVE?(n.i_.params.NEXT_MOVE=null,n.i_.params.CAN_MOVE=!1,n.i_.params.DIRECTION=37==_.which?i:r):n.i_.params.NEXT_MOVE=37==_.which?i:r);break;case 38:case 40:_.preventDefault(),n.i_.params.STARTED&&n.i_.params.DIRECTION!=a&&n.i_.params.DIRECTION!=e&&(n.i_.params.CAN_MOVE?(n.i_.params.NEXT_MOVE=null,n.i_.params.CAN_MOVE=!1,n.i_.params.DIRECTION=38==_.which?e:a):n.i_.params.NEXT_MOVE=38==_.which?e:a);break;case 88:n.i_.params.SPEED<10&&n.i_.params.STARTED&&(n.i_.params.SPEED++,n.i_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+n.i_.params.SPEED);break;case 90:n.i_.params.SPEED>1&&n.i_.params.STARTED&&(n.i_.params.SPEED--,n.i_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+n.i_.params.SPEED)}}},t.prototype={init:function(){for(var e=0;e<this.pos.length;e++)this.drawPlayer(this.pos[e])},movePlayerPiece:function(e,a){if(coll=this.checkForCollision(e),!coll){var i=document.getElementById("p_"+a.x+"_"+a.y);i.id="p_"+e.x+"_"+e.y,i.style.top=e.y*n.i_.params.PIECE_WIDTH,i.style.left=e.x*n.i_.params.PIECE_WIDTH}},expandPlayer:function(e){var a=document.getElementById("lblScore"),i=parseInt(a.innerHTML)+1;a.innerHTML=parseInt(a.innerHTML)+1,i==n.i_.params.LEVEL_UP[n.i_.params.SPEED-1]&&n.i_.params.SPEED<10&&(n.i_.params.SPEED++,n.i_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+n.i_.params.SPEED),this.drawPlayer(e),n.i_.containerElement.removeChild(document.getElementById("food_item")),n.i_.food=new E},checkForCollision:function(t){var _=document.getElementById("p_"+t.x+"_"+t.y);if(n.i_.params.DIRECTION==e&&0==t.y||n.i_.params.DIRECTION==a&&t.y==n.i_.config.BOARD_HEIGHT-1||n.i_.params.DIRECTION==r&&t.x==n.i_.config.BOARD_WIDTH-1||n.i_.params.DIRECTION==i&&0==t.x||_){n.i_.params.STARTED=!1,document.getElementById("p_"+n.i_.player.pos[1].x+"_"+n.i_.player.pos[1].y).style.backgroundColor="#aa0000";var E=document.getElementById("lblScore"),s=document.getElementById("lblHighscore");return parseInt(E.innerHTML)>parseInt(s.innerHTML)&&(s.innerHTML=E.innerHTML),document.getElementById("lblStatus").innerHTML="Game over",!0}return!1},drawPlayer:function(e){var a=document.createElement("div");a.id="p_"+e.x+"_"+e.y,a.className=n.classes.PLAYER,a.style.width=n.i_.params.PIECE_WIDTH+"px",a.style.height=n.i_.params.PIECE_WIDTH+"px",a.style.top=e.y*n.i_.params.PIECE_WIDTH,a.style.left=e.x*n.i_.params.PIECE_WIDTH,n.i_.containerElement.appendChild(a)}},_.prototype={init:function(){this.drawBorder(0,0,n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH,n.i_.params.PIECE_WIDTH),this.drawBorder((n.i_.config.BOARD_HEIGHT-1)*n.i_.params.PIECE_WIDTH,0,n.i_.config.BOARD_WIDTH*n.i_.params.PIECE_WIDTH,n.i_.params.PIECE_WIDTH),this.drawBorder(0,0,n.i_.params.PIECE_WIDTH,n.i_.config.BOARD_HEIGHT*n.i_.params.PIECE_WIDTH),this.drawBorder(0,(n.i_.config.BOARD_WIDTH-1)*n.i_.params.PIECE_WIDTH,n.i_.params.PIECE_WIDTH,n.i_.config.BOARD_HEIGHT*n.i_.params.PIECE_WIDTH)},drawBorder:function(e,a,i,r){var t=document.createElement("div");t.className=n.classes.BORDER,t.style.top=e+"px",t.style.left=a+"px",t.style.width=i+"px",t.style.height=r+"px",n.i_.containerElement.appendChild(t)}},E.prototype={init:function(){for(var e=[],a=0;a<n.i_.config.BOARD_HEIGHT-2;a++)for(var i=0;i<n.i_.config.BOARD_WIDTH-2;i++)document.getElementById("p_"+(i+1)+"_"+(a+1))||e.push({x:i+1,y:a+1});var r=Math.floor(Math.random()*(e.length-1)),t={x:1,y:1};e.length>0&&(t=e[r]),this.pos={x:t.x,y:t.y};var _=document.createElement("div");_.id="food_item",_.className=n.classes.FOOD,_.style.top=t.y*n.i_.params.PIECE_WIDTH+"px",_.style.left=t.x*n.i_.params.PIECE_WIDTH+"px",_.style.width=n.i_.params.PIECE_WIDTH+"px",_.style.height=n.i_.params.PIECE_WIDTH+"px",n.i_.containerElement.appendChild(_)}}}();

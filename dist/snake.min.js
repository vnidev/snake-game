!function(){var e=0,a=1,i=2,s=3;function r(e,a){if(r.i_)return r.i_;r.i_=this,a&&(a.SPEED?a.SPEED>10?a.SPEED=10:a.SPEED<1&&(a.SPEED=1):a.SPEED=r.config.SPEED,a.BOARD_WIDTH?a.BOARD_WIDTH>40?a.BOARD_WIDTH=40:a.BOARD_WIDTH<10&&(a.BOARD_WIDTH=10):a.BOARD_WIDTH=r.config.BOARD_WIDTH,a.BOARD_HEIGHT?a.BOARD_HEIGHT>20?a.BOARD_HEIGHT=20:a.BOARD_HEIGHT<5&&(a.BOARD_HEIGHT=5):a.BOARD_HEIGHT=r.config.BOARD_HEIGHT),r.i_.config=a||r.config,r.i_.params=r.params,r.i_.params.SPEED=r.i_.config.SPEED,r.i_.config.BOARD_HEIGHT+=2,r.i_.config.BOARD_WIDTH+=2;var i=document.querySelector(e),s=window.innerWidth,t=window.innerHeight;(s<r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH+20||t<r.i_.config.BOARD_HEIGHT*r.i_.params.PIECE_WIDTH+20)&&(r.params.PIECE_WIDTH=16,i.className="low-res");var _=document.createElement("div");_.className=r.classes.SCORE,_.style.width=r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH+"px";var n=document.createElement("div");n.style.float="left";var E=document.createElement("label");E.innerHTML="Highscore: ",n.appendChild(E);var o=document.createElement("label");o.id="lblHighscore",o.innerHTML="0",n.appendChild(o),_.appendChild(n);var p=document.createElement("div");p.style.float="right";var c=document.createElement("label");c.innerHTML="Score: ",p.appendChild(c);var l=document.createElement("label");l.id="lblScore",l.innerHTML="0",p.appendChild(l),_.appendChild(p),i.appendChild(_);var m=document.createElement("div");m.className=r.classes.CONTAINER,i.appendChild(m),i.style.width=r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH+"px",r.i_.containerElement=m,r.i_.containerElement.style.width=r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH+"px",r.i_.containerElement.style.height=r.i_.config.BOARD_HEIGHT*r.i_.params.PIECE_WIDTH+"px";var d=document.createElement("div");d.className=r.classes.PROGRESS,d.style.width=r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH+"px";var D=document.createElement("label");D.id="lblStatus",D.innerHTML="Press space to start game",d.appendChild(D),i.appendChild(d),r.i_.init()}function t(){var e=Math.ceil((r.i_.config.BOARD_HEIGHT-2)/2);this.pos=[{x:4,y:e},{x:3,y:e},{x:2,y:e}],this.init()}function _(){this.init()}function n(){this.init()}window.Game=r,r.params={SPEED:1,FPS:35,CURRENT_FRAME:0,STARTED:!1,DIRECTION:s,PIECE_WIDTH:32,CAN_MOVE:!0,NEXT_MOVE:null,LEVELS:[30,25,20,17,14,11,9,7,5,3],LEVEL_UP:[5,10,17,25,35,50,75,110,150]},r.config={SPEED:1,BOARD_WIDTH:20,BOARD_HEIGHT:10},r.classes={CONTAINER:"container",SCORE:"score",PROGRESS:"progress",BORDER:"border_background",FOOD:"sprite_background sprite_background_food",PLAYER:"sprite_background",HEAD_R:"sprite_background sprite_background_head",HEAD_L:"sprite_background sprite_background_head rotate180",HEAD_U:"sprite_background sprite_background_head rotate270",HEAD_D:"sprite_background sprite_background_head rotate90",TAIL_R:"sprite_background sprite_background_tail",TAIL_L:"sprite_background sprite_background_tail rotate180",TAIL_U:"sprite_background sprite_background_tail rotate270",TAIL_D:"sprite_background sprite_background_tail rotate90",BODY_H:"sprite_background sprite_background_body",BODY_V:"sprite_background sprite_background_body rotate90",BODY_RU:"sprite_background sprite_background_body_ru",BODY_RD:"sprite_background sprite_background_body_lu rotate180",BODY_LU:"sprite_background sprite_background_body_lu",BODY_LD:"sprite_background sprite_background_body_ru rotate180"},r.prototype={init:function(){document.addEventListener("keydown",function(e){r.i_.keyPressAction(e)}.bind(r.i_)),r.i_.board=new _},gameProgress:function(){if(r.i_.params.CURRENT_FRAME==r.i_.params.LEVELS[r.i_.params.SPEED-1]){r.i_.params.CAN_MOVE=!0;var s,t=r.i_.player.pos[0];switch(r.i_.params.DIRECTION){case e:s={x:t.x,y:t.y-1};break;case a:s={x:t.x,y:t.y+1};break;case i:s={x:t.x-1,y:t.y};break;default:s={x:t.x+1,y:t.y}}if(r.i_.player.pos.unshift(s),s.x==r.i_.food.pos.x&&s.y==r.i_.food.pos.y)r.i_.player.expandPlayer(s);else{var _=r.i_.player.pos.pop();r.i_.player.movePlayerPiece(s,_)}r.i_.params.CURRENT_FRAME=0,r.i_.params.NEXT_MOVE&&(r.i_.params.DIRECTION=r.i_.params.NEXT_MOVE,r.i_.params.NEXT_MOVE=null)}r.i_.params.STARTED&&(r.i_.params.CURRENT_FRAME++,window.requestAnimationFrame(r.i_.gameProgress.bind(this)))},keyPressAction:function(_){switch(_.which){case 32:if(_.preventDefault(),!r.i_.params.STARTED){r.i_.params.STARTED=!0;var E=document.getElementsByClassName(r.classes.PLAYER);if(E.length>0)for(;E[0];)r.i_.containerElement.removeChild(E[0]);var o=document.getElementById("food_item");o&&r.i_.containerElement.removeChild(o),document.getElementById("lblScore").innerHTML=0,r.i_.params.SPEED=r.i_.config.SPEED,r.i_.params.CAN_MOVE=!0,r.i_.params.DIRECTION=s,r.i_.player=new t,r.i_.food=new n,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+r.i_.params.SPEED,r.i_.gameProgress()}break;case 37:case 39:_.preventDefault(),r.i_.params.STARTED&&r.i_.params.DIRECTION!=i&&r.i_.params.DIRECTION!=s&&(r.i_.params.CAN_MOVE?(r.i_.params.NEXT_MOVE=null,r.i_.params.CAN_MOVE=!1,r.i_.params.DIRECTION=37==_.which?i:s):r.i_.params.NEXT_MOVE=37==_.which?i:s);break;case 38:case 40:_.preventDefault(),r.i_.params.STARTED&&r.i_.params.DIRECTION!=a&&r.i_.params.DIRECTION!=e&&(r.i_.params.CAN_MOVE?(r.i_.params.NEXT_MOVE=null,r.i_.params.CAN_MOVE=!1,r.i_.params.DIRECTION=38==_.which?e:a):r.i_.params.NEXT_MOVE=38==_.which?e:a);break;case 88:r.i_.params.SPEED<10&&r.i_.params.STARTED&&(r.i_.params.SPEED++,r.i_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+r.i_.params.SPEED);break;case 90:r.i_.params.SPEED>1&&r.i_.params.STARTED&&(r.i_.params.SPEED--,r.i_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+r.i_.params.SPEED)}}},t.prototype={init:function(){for(var e=0;e<this.pos.length;e++)this.drawPlayer(this.pos[e]);var a=this.pos[this.pos.length-1],i=this.pos[0];document.getElementById("p_"+i.x+"_"+i.y).className=r.classes.HEAD_R,document.getElementById("p_"+a.x+"_"+a.y).className=r.classes.TAIL_R},movePlayerPiece:function(e,a){if(coll=this.checkForCollision(e),!coll){var i=document.getElementById("p_"+a.x+"_"+a.y);i.id="p_"+e.x+"_"+e.y,i.style.top=e.y*r.i_.params.PIECE_WIDTH,i.style.left=e.x*r.i_.params.PIECE_WIDTH,this.updateHeadGraphic(),this.updateGraphic(),this.updateTailGraphic()}},updateHeadGraphic:function(){var s=this.pos[0],t="";switch(r.params.DIRECTION){case e:t=r.classes.HEAD_U;break;case a:t=r.classes.HEAD_D;break;case i:t=r.classes.HEAD_L;break;default:t=r.classes.HEAD_R}document.getElementById("p_"+s.x+"_"+s.y).className=t},updateTailGraphic:function(){var e=this.pos[this.pos.length-1],a=this.pos[this.pos.length-2],i=r.classes.TAIL_R;e.x>a.x?i=r.classes.TAIL_L:e.y>a.y?i=r.classes.TAIL_U:e.y<a.y&&(i=r.classes.TAIL_D),document.getElementById("p_"+e.x+"_"+e.y).className=i},updateGraphic:function(){var i,s=this.pos[2],t=this.pos[1],_=this.pos[0];i=t.x==s.x+1&&t.y==_.y+1||t.y==s.y+1&&t.x==_.x+1?r.classes.BODY_RU:t.x==s.x-1&&t.y==_.y+1||t.y==s.y+1&&t.x==_.x-1?r.classes.BODY_LU:t.y==s.y-1&&t.x==_.x-1||t.x==s.x-1&&t.y==_.y-1?r.classes.BODY_LD:t.x==s.x+1&&t.y==_.y-1||t.y==s.y-1&&t.x==_.x+1?r.classes.BODY_RD:r.params.DIRECTION==e||r.params.DIRECTION==a?r.classes.BODY_V:r.classes.BODY_H,document.getElementById("p_"+t.x+"_"+t.y).className=i},expandPlayer:function(e){var a=document.getElementById("lblScore"),i=parseInt(a.innerHTML)+1;a.innerHTML=parseInt(a.innerHTML)+1,i==r.i_.params.LEVEL_UP[r.i_.params.SPEED-1]&&r.i_.params.SPEED<10&&(r.i_.params.SPEED++,r.i_.params.CURRENT_FRAME=0,document.getElementById("lblStatus").innerHTML="Game in progress, level: "+r.i_.params.SPEED),this.drawPlayer(e),r.i_.containerElement.removeChild(document.getElementById("food_item")),r.i_.food=new n,this.updateHeadGraphic(),this.updateGraphic(1)},checkForCollision:function(t){var _=document.getElementById("p_"+t.x+"_"+t.y);if(r.i_.params.DIRECTION==e&&0==t.y||r.i_.params.DIRECTION==a&&t.y==r.i_.config.BOARD_HEIGHT-1||r.i_.params.DIRECTION==s&&t.x==r.i_.config.BOARD_WIDTH-1||r.i_.params.DIRECTION==i&&0==t.x||_){r.i_.params.STARTED=!1;var n=document.getElementById("p_"+r.i_.player.pos[1].x+"_"+r.i_.player.pos[1].y);n.className=n.className.replace("_head","_head_dead");var E=document.getElementById("lblScore"),o=document.getElementById("lblHighscore");return parseInt(E.innerHTML)>parseInt(o.innerHTML)&&(o.innerHTML=E.innerHTML),document.getElementById("lblStatus").innerHTML="Game over",!0}return!1},drawPlayer:function(e){var a=document.createElement("div");a.id="p_"+e.x+"_"+e.y,a.className=r.classes.BODY_H,a.style.width=r.i_.params.PIECE_WIDTH+"px",a.style.height=r.i_.params.PIECE_WIDTH+"px",a.style.top=e.y*r.i_.params.PIECE_WIDTH,a.style.left=e.x*r.i_.params.PIECE_WIDTH,r.i_.containerElement.appendChild(a)}},_.prototype={init:function(){this.drawBorder(0,0,r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH,r.i_.params.PIECE_WIDTH),this.drawBorder((r.i_.config.BOARD_HEIGHT-1)*r.i_.params.PIECE_WIDTH,0,r.i_.config.BOARD_WIDTH*r.i_.params.PIECE_WIDTH,r.i_.params.PIECE_WIDTH),this.drawBorder(0,0,r.i_.params.PIECE_WIDTH,r.i_.config.BOARD_HEIGHT*r.i_.params.PIECE_WIDTH),this.drawBorder(0,(r.i_.config.BOARD_WIDTH-1)*r.i_.params.PIECE_WIDTH,r.i_.params.PIECE_WIDTH,r.i_.config.BOARD_HEIGHT*r.i_.params.PIECE_WIDTH)},drawBorder:function(e,a,i,s){var t=document.createElement("div");t.className=r.classes.BORDER,t.style.top=e+"px",t.style.left=a+"px",t.style.width=i+"px",t.style.height=s+"px",r.i_.containerElement.appendChild(t)}},n.prototype={init:function(){for(var e=[],a=0;a<r.i_.config.BOARD_HEIGHT-2;a++)for(var i=0;i<r.i_.config.BOARD_WIDTH-2;i++)document.getElementById("p_"+(i+1)+"_"+(a+1))||e.push({x:i+1,y:a+1});var s=Math.floor(Math.random()*(e.length-1)),t={x:1,y:1};e.length>0&&(t=e[s]),this.pos={x:t.x,y:t.y};var _=document.createElement("div");_.id="food_item",_.className=r.classes.FOOD,_.style.top=t.y*r.i_.params.PIECE_WIDTH+"px",_.style.left=t.x*r.i_.params.PIECE_WIDTH+"px",_.style.width=r.i_.params.PIECE_WIDTH+"px",_.style.height=r.i_.params.PIECE_WIDTH+"px",r.i_.containerElement.appendChild(_)}}}();
